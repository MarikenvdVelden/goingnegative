---
title: 'Analysis'
author: "Dirck de Kleer & Mariken A.C.G. van der Velden"
output: 
  github_document:
    toc: yes
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(printr)
library(rmarkdown)
```

# Scripts
- [Required Packages &amp; Reproducibility](#required-packages-&amp;-reproducibility)
- [Analysis](#analysis)
  - [Specifying the Multiverse](#specifiying-the-multiverse)
  - [H1a](#H1a)
  - [H1b](#H1b)
  - [H2a](#H2a)
  - [H2b](#H2b)
  
## Required Packages &amp; Reproducibility
```{r, message=FALSE, warning=F}
rm(list=ls())

source("../lib/functions.R")
```

## Analysis
mean: standartdization + 1 stdev above and beyond
```{r}
load("../data/intermediate/cleaned_data.RData")
df <- d %>%
  mutate(negative_appeal = ifelse(direction_appeal=="Negative Appeal",
                                  1,0)) %>%
  group_by(party, date) %>%
  summarise(negative_appeals = n(),
            m_na = mean(negative_appeal, na.rm = T),
            d_na = negative_appeals - m_na,
            polls1 = mean(poll_standing1, na.rm = T),
            polls2 = mean(poll_standing2, na.rm = T),
            polls3 = mean(poll_standing3, na.rm = T),
            polls4 = mean(poll_standing4, na.rm = T),
            polls5 = mean(poll_standing5, na.rm = T),
            polls6 = mean(poll_standing6, na.rm = T),
            polls7 = mean(poll_standing7, na.rm = T),
            polls8 = mean(poll_standing8, na.rm = T),
            polls9 = mean(poll_standing9, na.rm = T),
            io1 = mean(aio_percentage, na.rm = T),
            io2 = mean(cio_mean, na.rm = T),
            io3 = mean(cio_median, na.rm = T),
            io4 = mean(cio_sd, na.rm = T),
            ie1 = mean(ie_median_ches2017, na.rm = T),
            ie2 = mean(ie_mean_ches2017, na.rm = T),
            ie3 = mean(ie_median_ches2014, na.rm = T),
            ie4 = mean(ie_mean_ches2014, na.rm = T),
            ie5 = mean(ie_median_cmp2017, na.rm = T),
            ie6 = mean(ie_mean_cmp2017, na.rm = T),
            ie7 = mean(ie_median_cmp2012, na.rm = T),
            ie8 = mean(ie_mean_cmp2012, na.rm = T),
            ji1  = mean(journalistic_intervenience, na.rm = T),
            ji2 = sum(journalistic_intervenience),
            ji3 = ji2-ji1
            ) %>%
  mutate(opposition = ifelse(party == "VVD", 0,
                      ifelse(party == "PvdA", 0, 1)),
         new_party = ifelse(party == "FvD", 1, 0),
         ie3 = ifelse(party == "FvD", 0, ie3),
         ie4 = ifelse(party == "FvD", 0, ie4),
         ie7 = ifelse(party == "FvD", 0, ie7),
         ie8 = ifelse(party == "FvD", 0, ie8)
         ) %>%
  ungroup()

df <- slide(data = df, Var = "negative_appeals", TimeVar = "date",
               GroupVar = "party", NewVar = "l_negative_appeal", 
            slideBy = -1)

df <- df %>%
  mutate(d_negative_appeal = negative_appeals - l_negative_appeal) 
```


```{r}
results <- run_specs(df = df,
                      y = c("d_na"),
                      x = c("ji1", "ji2", "ji3"),
                      controls = c("polls1","polls2","polls3","polls4",
                                  "polls5","polls6","polls7","polls8",
                                  "polls9",
                                  "ie1","ie2","ie3","ie4","ie5","ie6",
                                  "ie7","ie8",
                                  "io1","io2","io3","io4"),
                      model = "lmer_mv")
plot_specs(results)

```


